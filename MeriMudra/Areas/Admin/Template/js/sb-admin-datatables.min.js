$(document).ready(function () {

    $("#dataTable").DataTable();   
    $(function () {
       
        var start = moment().subtract(29, 'days');
        var end = moment();

        function cb(start, end) {
            
            $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
            //alert(start.format('MM/DD/YYYY') + "," + end.format('MM/DD/YYYY'));
            var controler = $("#prtView").attr('export-controler');
            var action = $("#prtView").attr('export-action');
            if (typeof controler === "undefined") { } else {
                generateReport(start.format('MM/DD/YYYY'), end.format('MM/DD/YYYY'), controler, action);
            }
        }

        $('#reportrange').daterangepicker({
            startDate: start,
            endDate: end,
            ranges: {
                'Today': [moment(), moment()],
                'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                'This Month': [moment().startOf('month'), moment().endOf('month')],
                'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            }
        }, cb);

        cb(start, end);

    });
});
function setDataTabeJs()
{
    var buttonCommon = {
        init: function (dt, node, config) {
            var table = dt.table().context[0].nTable;
            if (table) config.title = $(table).data('export-title')
        },
        title: 'default title'
    };
    var columns_no = Number($("#dataTable_button").data('export-column'));
    var columns = [];
    for (var i = 0; i < columns_no; i++) {
        columns.push(i);
    }
    $("#dataTable_button").DataTable({
        dom: 'Bfrtip',
        buttons: [

             $.extend(true, {}, buttonCommon, {
                 extend: 'excelHtml5',
                 // messageTop: title,
                 exportOptions: {
                     columns: columns
                 }
             }),
               $.extend(true, {}, buttonCommon, {
                   extend: 'csvHtml5',
                   // messageTop: title,
                   exportOptions: {
                       columns: columns
                   }
               }),
                 $.extend(true, {}, buttonCommon, {
                     extend: 'pdfHtml5',
                     // messageTop: title,
                     exportOptions: {
                         columns: columns
                     }
                 })
            // {
            //     extend: 'csvHtml5',
            //     exportOptions: {
            //         columns: columns
            //     }
            // },
            //{
            //    extend: 'pdfHtml5',
            //    exportOptions: {
            //        columns: columns
            //    }
            //}
        ]
    });
}
function deleteMethod(controller, action, id) {
    var FormActionURL = $("#baseURL").text() + "/" + controller + "/" + action;
    var Paramerter = {
        id: id,
        __RequestVerificationToken: $('input[name=__RequestVerificationToken]').val()
    }
    $.ajax({
        type: "POST",
        url: FormActionURL,
        cache: false,
        //async: false,
        data: Paramerter,
        success: function (data) {
            //debugger;
            window.location.href = $("#baseURL").text() + "/Admin/" + controller + "/Index";
        },
        error: function () {

        }
    });
}
function addActionInConfirmBox(controller, action, id) {
    $("#cinfirmBox").attr("onclick", "deleteMethod('" + controller + "', '" + action + "', '" + id + "');");
}
function removeActionInConfirm(controller, action, id) {
    $("#cinfirmBox").removeAttr("onclick");
}
function generateReport(fromdate, todate, controller, action) {
    $('#loading_image').show(); 
    var FormActionURL = $("#baseURL").text() + "/Admin/" + "/" + controller + "/" + action;
    var Paramerter = {
        fromdate: fromdate,
        todate: todate
    }
    $.ajax({
        type: "POST",
        url: FormActionURL,
        cache: false,
        //async: false,
        data: Paramerter,
        success: function (data) {
            $("#prtView").html(data);
            setDataTabeJs();
            $('#loading_image').hide();
        },
        error: function () {
            $('#loading_image').hide();
        }
    });
}